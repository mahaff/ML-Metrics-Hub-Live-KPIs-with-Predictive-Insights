<!DOCTYPE html>
<html>
<head>
    <title>ML Churn Dashboard</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f8fafc;
            padding: 40px;
            color: #222;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            padding: 32px 40px 40px 40px;
        }
        h2 {
            color: #2d6cdf;
            margin-bottom: 18px;
            letter-spacing: 1px;
        }
        table.data {
            width: 100%;
            border-collapse: collapse;
            margin-top: 24px;
            background: #f9fbfd;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(44, 62, 80, 0.04);
        }
        th, td {
            padding: 12px 10px;
            border: 1px solid #e3e8ee;
            text-align: center;
        }
        th {
            background-color: #eaf1fb;
            color: #2d6cdf;
            font-weight: 600;
        }
        tr:nth-child(even) td {
            background: #f4f8fc;
        }
        tr:hover td {
            background: #eaf1fb;
            transition: background 0.2s;
        }
        .churn-risk-1 {
            background: #ffeaea !important;
            color: #d32f2f;
            font-weight: bold;
        }
        .churn-risk-0 {
            background: #eaffea !important;
            color: #388e3c;
            font-weight: bold;
        }
        #barChartContainer {
            margin-top: 32px;
            background: #f9fbfd;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(44, 62, 80, 0.04);
            padding: 24px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Highlight churn_risk column after table loads
        window.onload = function() {
            const tables = document.querySelectorAll('table.data');
            tables.forEach(table => {
                const headers = Array.from(table.querySelectorAll('th'));
                const churnIdx = headers.findIndex(th => th.innerText.trim().toLowerCase() === 'churn_risk');
                if (churnIdx !== -1) {
                    table.querySelectorAll('tr').forEach((row, i) => {
                        if (i === 0) return; // skip header
                        const cell = row.children[churnIdx];
                        if (cell) {
                            if (cell.innerText.trim() === "1") {
                                cell.classList.add('churn-risk-1');
                            } else if (cell.innerText.trim() === "0") {
                                cell.classList.add('churn-risk-0');
                            }
                        }
                    });
                }
            });

            // Bar chart logic
            // Try to extract data from the table for the last 10 days
            const table = document.querySelector('table.data');
            if (table) {
                const rows = Array.from(table.querySelectorAll('tr')).slice(1); // skip header
                const labels = [];
                const churnRisks = [];
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length > 0) {
                        labels.push(cells[0].innerText); // date
                        churnRisks.push(Number(cells[cells.length - 1].innerText)); // churn_risk
                    }
                });

                // Draw bar chart
                const ctx = document.getElementById('barChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels.reverse(),
                        datasets: [{
                            label: 'Churn Risk (1=High, 0=Low)',
                            data: churnRisks.reverse(),
                            backgroundColor: churnRisks.map(v => v === 1 ? '#ffeaea' : '#eaffea'),
                            borderColor: churnRisks.map(v => v === 1 ? '#d32f2f' : '#388e3c'),
                            borderWidth: 2
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value) { return value === 1 ? 'High' : 'Low'; }
                                }
                            }
                        }
                    }
                });
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <h2>ðŸ“Š Real-Time ML Churn Dashboard</h2>
        <div id="barChartContainer">
            <canvas id="barChart" height="100"></canvas>
        </div>
        {{ tables|safe }}
    </div>
</body>
</html>